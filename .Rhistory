X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- simGLM.normal(Xi = X,
alpha0 = 1,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
Y0 <- simGLM.normal(Xi = X,
alpha0 = 0,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
test
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
test
n <- 500
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
test
0.01009157/0.01058852
(0.01058852-0.01009157)/0.01058852
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- simGLM.normal(Xi = X,
alpha0 = 1,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
Y0 <- simGLM.normal(Xi = X,
alpha0 = 0,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
0.0147587587873082/0.0637716434277557
0.0169404312286316/0.0147587587873082
library(MYHRcpp)
n <- 500
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
library(MYHRcpp)
n <- 500
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
library(MYHRcpp)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
response = Y
treatment = trt
confounder = X
response <- as.vector(response)
treatment <- as.vector(treatment)
confounder <- as.matrix(confounder)
X1 <- as.matrix(confounder[treatment==1, ])
X0 <- as.matrix(confounder[treatment==0, ])
Y1 <- response[treatment==1]
Y0 <- response[treatment==0]
MDR1.prior <- CVMDR(X = X1, Y = Y1,
initial = initial1.prior,
kernel = kernel.prior,
wi.boot = wi.boot, stop.prop = stop.prop,
do.print = do.print)
B1.prior = NULL
B0.prior = NULL
initial1.prior = NULL
initial0.prior = NULL
kernel.prior = "K2_Biweight"
bandwidth1.prior = NULL
bandwidth0.prior = NULL
initial = NULL
kernel = "K2_Biweight"
wi.boot = NULL
stop.prop = 0.95
do.print = TRUE
response <- as.vector(response)
treatment <- as.vector(treatment)
confounder <- as.matrix(confounder)
X1 <- as.matrix(confounder[treatment==1, ])
X0 <- as.matrix(confounder[treatment==0, ])
Y1 <- response[treatment==1]
Y0 <- response[treatment==0]
MDR1.prior <- CVMDR(X = X1, Y = Y1,
initial = initial1.prior,
kernel = kernel.prior,
wi.boot = wi.boot, stop.prop = stop.prop,
do.print = do.print)
B1.prior <- MDR1.prior$basis
bandwidth1.prior <- MDR1.prior$bandwidth
B1.prior
bandwidth1.prior
MDR0.prior <- CVMDR(X = X0, Y = Y0,
initial = initial0.prior,
kernel = kernel.prior,
wi.boot = wi.boot, stop.prop = stop.prop,
do.print = do.print)
B0.prior <- MDR0.prior$basis
bandwidth0.prior <- MDR0.prior$bandwidth
B0.prior
bandwidth0.prior
Di.impute <- (response-
NW(X = X0 %*% B0.prior, Y = Y0,
x = confounder %*% B0.prior,
regression = "mean",
kernel = kernel.prior,
bandwidth = bandwidth0.prior,
wi.boot = wi.boot))*treatment+
(NW(X = X1 %*% B1.prior, Y = Y1,
x = confounder %*% B1.prior,
regression = "mean",
kernel = kernel.prior,
bandwidth = bandwidth1.prior,
wi.boot = wi.boot)-response)*(1-treatment)
View(Di.impute)
results <- CVMDR(X = confounder, Y = Di.impute, initial = initial,
kernel = kernel,
wi.boot = wi.boot, stop.prop = stop.prop,
do.print = do.print)
library(MYHRcpp)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
test$detail.cv
n <- 500
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
test$dimension
test$basis
test$bandwidth
n <- 200
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
n <- 300
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
n <- 400
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
0.00933741217153652/0.0102442646412464
library(MYHRcpp)
n <- 100
p <- 5
Xi <- matrix(rnorm(n*p), n, p)
Ci <- 1+rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.SDR <- CVSDRsurv(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,
covariate = Xi)
library(MYHRcpp)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- simGLM.normal(Xi = X,
alpha0 = 1,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
Y0 <- simGLM.normal(Xi = X,
alpha0 = 0,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X, stop.prop = 0.9)
n <- 100
p <- 5
Xi <- matrix(rnorm(n*p), n, p)
Ci <- 1+rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
#####
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's')
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,)
n <- 100
p <- 5
Xi <- matrix(rnorm(n*p), n, p)
Ci <- 1+rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
#####
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's')
n <- 100
p <- 5
Xi <- matrix(rnorm(n*p), n, p)
Ci <- 1+rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
#####
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's')
Shat.cond <- SKME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,
X = Xi)
Shat.cond.1 <- SKME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,
t.event = seq(0, 5, 0.1),
X = Xi)
Shat.cond$survival[1, ]
Shat.cond.1$survival[1, ]
c(matrix(1:5, 5, 1), matrix(1:5, 1, 5))
library(MYHRcpp)
library(MYHRcpp)
library(MYHRcpp)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- simGLM.normal(Xi = X,
alpha0 = 1,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
Y0 <- simGLM.normal(Xi = X,
alpha0 = 0,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- rnorm(n, mean = 1, sd = 0.1)
Y0 <- rnorm(n, mean = 0, sd = 0.1)
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X, stop.prop = 0.9)
library(MYHRcpp)
n <- 100
p <- 5
set.seed(321)
X <- rnorm(n*p, mean = 0, sd = 1)
dim(X) <- c(n, p)
Y1 <- simGLM.normal(Xi = X,
alpha0 = 1,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
Y0 <- simGLM.normal(Xi = X,
alpha0 = 0,
beta0 = rep(0.2, p),
sigma0 = 0.1,
seed = 123)$response
trt <- simGLM.logistic(Xi = X,
alpha0 = 0.5,
beta0 = rep(0.5, p),
seed = 123)$response
Y <- Y1*trt+Y0*(1-trt)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X)
test <- CATE.CVMDR(response = Y,
treatment = trt,
confounder = X,
bandwidth.prior.scale = 1.2)
library(MYHRcpp)
microbenchmark::microbenchmark(
outer = KDE.generic(X = X, x = x, K = K2_Biweight, h = 1),
Rcpp = KDE_K2B_rcpp(X = X, x = x, h = 1),
Rcpp.chatgpt = KDE_K2B_rcpp_chatgpt(X = X, x = x, h = 1),
Rcpp1 = KDE_rcpp(X = X, x = x, K = K2_Biweight, h = 1)
)
library(MYHRcpp)
library(MYHRcpp)
microbenchmark::microbenchmark(
outer = KDE.generic(X = X, x = x, K = K2_Biweight, h = 1),
Rcpp = KDE_K2B_rcpp(X = X, x = x, h = 1),
Rcpp.chatgpt = KDE_K2B_rcpp_chatgpt(X = X, x = x, h = 1),
Rcpp1 = KDE_rcpp(X = X, x = x, K = K2_Biweight, h = 1)
)
n <- 100
p <- 1
X <- matrix(rnorm(n*p), nrow = n, ncol = p)
x <- as.matrix(seq(-3, 3, 0.1))
###
Dhat <- KDE.generic(X = X, x = x, K = K2_Biweight, h = 1)
Dhat_rcpp <- KDE_K2B_rcpp(X = X, x = x, h = 1)
Dhat_rcpp1 <- KDE_K4B_rcpp(X = X, x = x, h = 1)
Dhat_rcpp2 <- KDE_rcpp(X = X, x = x, K = K2_Biweight, h = 1)
mean((Dhat-Dhat_rcpp)^2)
hist(X, freq = FALSE)
lines(x, Dhat)
lines(x, dnorm(x), col = 2)
microbenchmark::microbenchmark(
outer = KDE.generic(X = X, x = x, K = K2_Biweight, h = 1),
Rcpp = KDE_K2B_rcpp(X = X, x = x, h = 1),
Rcpp.chatgpt = KDE_K2B_rcpp_chatgpt(X = X, x = x, h = 1),
Rcpp1 = KDE_rcpp(X = X, x = x, K = K2_Biweight, h = 1)
)
gitcreds::gitcreds_set()
library(MYHRcpp)
