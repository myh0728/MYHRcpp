is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1]))),
Rcpp_n1_a = KME_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event),
Rcpp_a = KME_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
)
Shat1 <- KME_w_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w)
Shat2 <- KME_w_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w[order(test.data1$t.stop)])
Shat2a <- KME_w_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order)
mean((Shat1 - Shat2) ^ 2)
mean((Shat2 - Shat2a) ^ 2)
microbenchmark::microbenchmark(
Rcpp = KME_w_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w),
Rcpp_n1 = KME_w_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w[order(test.data1$t.stop)]),
Rcpp_n1_a = KME_w_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order)
)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
w <- rexp(n)
w <- w / sum(w)
Shat <- KME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
Shat1 <- KME_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])))
Shat2 <- KME_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])))
mean((Shat$hazard - Shat1) ^ 2)
mean((Shat$hazard - Shat2) ^ 2)
t.event <- sort(unique(test.data1$t.stop[test.data1$is.event == 1]))
t.stop <- sort(test.data1$t.stop)
is.event <- test.data1$is.event[order(test.data1$t.stop)]
w.order <- w[order(test.data1$t.stop)]
Shat1a <- KME_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
Shat2a <- KME_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
mean((Shat1a - Shat2a) ^ 2)
microbenchmark::microbenchmark(
outer = KME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event),
Rcpp = KME_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1]))),
Rcpp_n1 = KME_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1]))),
Rcpp_n1_a = KME_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event),
Rcpp_a = KME_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
)
Shat1 <- KME_w_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w)
Shat2 <- KME_w_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w[order(test.data1$t.stop)])
Shat1a <- KME_w_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order)
Shat2a <- KME_w_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order)
mean((Shat1 - Shat2) ^ 2)
mean((Shat1 - Shat1a) ^ 2)
mean((Shat2 - Shat2a) ^ 2)
microbenchmark::microbenchmark(
Rcpp = KME_w_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w),
Rcpp_n1 = KME_w_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w[order(test.data1$t.stop)]),
Rcpp_n1_a = KME_w_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order),
Rcpp_a = KME_w_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order)
)
library(MYHRcpp)
Shat <- SKME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,
X = Xi, x = Xi, K = K2_Biweight, h = 1)
Shat1 <- SKME_K2B_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
X = Xi, x = Xi, h = 1)
Shat <- SKME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,
X = Xi, x = Xi, K = K2_Biweight, h = 1)
Shat1 <- SKME_K2B_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
X = Xi, x = Xi, h = rep(1, length = p))
mean(abs(Shat - Shat1))
Shat <- SKME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,
X = Xi, x = Xi, K = K2_Biweight, h = 1)
Shat1 <- SKME_K2B_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
X = Xi, x = Xi, h = rep(1, length = p))
mean(abs(Shat$hazard - Shat1))
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
w <- rexp(n)
w <- w / sum(w)
###
Shat <- KME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
dLhat1 <- KME_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])))
dLhat2 <- KME_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])))
mean((Shat$hazard - dLhat1) ^ 2)
mean((Shat$hazard - dLhat2) ^ 2)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
w <- rexp(n)
w <- w / sum(w)
###
Shat <- KME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
dLhat1 <- KME_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])))
dLhat2 <- KME_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])))
mean((Shat$hazard - dLhat1) ^ 2)
mean((Shat$hazard - dLhat2) ^ 2)
t.event <- sort(unique(test.data1$t.stop[test.data1$is.event == 1]))
t.stop <- sort(test.data1$t.stop)
is.event <- test.data1$is.event[order(test.data1$t.stop)]
w.order <- w[order(test.data1$t.stop)]
dLhat1a <- KME_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
dLhat2a <- KME_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
mean((dLhat1a - dLhat2a) ^ 2)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
w <- rexp(n)
w <- w / sum(w)
###
Shat <- KME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
dLhat1 <- KME_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])))
dLhat2 <- KME_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])))
mean((Shat$hazard - dLhat1) ^ 2)
mean((Shat$hazard - dLhat2) ^ 2)
t.event <- sort(unique(test.data1$t.stop[test.data1$is.event == 1]))
t.stop <- sort(test.data1$t.stop)
is.event <- test.data1$is.event[order(test.data1$t.stop)]
w.order <- w[order(test.data1$t.stop)]
dLhat1a <- KME_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
dLhat2a <- KME_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
mean((dLhat1a - dLhat2a) ^ 2)
microbenchmark::microbenchmark(
outer = KME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event),
Rcpp = KME_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1]))),
Rcpp_n1 = KME_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1]))),
Rcpp_n1_a = KME_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event),
Rcpp_a = KME_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event)
)
dLhat1 <- KME_w_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w)
dLhat2 <- KME_w_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w[order(test.data1$t.stop)])
dLhat1a <- KME_w_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order)
dLhat2a <- KME_w_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order)
mean((dLhat1 - dLhat2) ^ 2)
mean((dLhat1 - dLhat1a) ^ 2)
mean((dLhat2 - dLhat2a) ^ 2)
microbenchmark::microbenchmark(
Rcpp = KME_w_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w),
Rcpp_n1 = KME_w_rcpp_n1(t_stop = sort(test.data1$t.stop),
is_event = test.data1$is.event[order(test.data1$t.stop)],
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
w = w[order(test.data1$t.stop)]),
Rcpp_n1_a = KME_w_rcpp_n1(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order),
Rcpp_a = KME_w_rcpp(t_stop = t.stop,
is_event = is.event,
t_event = t.event,
w = w.order)
)
###
Shat <- SKME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,
X = Xi, x = Xi, K = K2_Biweight, h = 1)
dLhat1 <- SKME_K2B_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
X = Xi, x = Xi, h = rep(1, length = p))
mean(abs(Shat$hazard - dLhat1))
mean(abs(Shat$hazard - dLhat1))
microbenchmark::microbenchmark(
outer = SKME.outer(t.stop = test.data1$t.stop,
is.event = test.data1$is.event,
X = Xi, x = Xi, K = K2_Biweight, h = 1),
Rcpp = SKME_K2B_rcpp(t_stop = test.data1$t.stop,
is_event = test.data1$is.event,
t_event = sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
X = Xi, x = Xi, h = rep(1, length = p))
)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
library(MYHRcpp)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's')
plot(Shat$jumps, Shat$survival, type = 's',
xlab = "time", ylab = "survival")
test.data1$failure.time
ecdf(test.data1$failure.time)
1-ecdf(test.data1$failure.time)
Fhat <- ecdf(test.data1$failure.time)
Fhat
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
#####
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's',
xlab = "time", ylab = "survival")
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
#####
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's',
xlab = "time", ylab = "survival")
Shat
Shat$jumps
Shat$survival
plot(Shat$jumps, Shat$survival, type = 's',
xlab = "time", ylab = "survival")
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
test.data2$t.stop
beta0 = rep(1, 5)
cumhazard.inv = function(t){t}
seed = NULL
Xi <- as.matrix(Xi)
Ci <- as.vector(as.matrix(Ci))
number_n <- dim(Xi)[1]
number_p <- dim(Xi)[2]
if (!is.null(seed))
{
set.seed(seed)
}
Ui <- runif(n = number_n, min = 0, max = 1)
Ti <- cumhazard.inv(-log(1 - Ui) / exp(Xi %*% beta0))
Yi <- pmin(Ti, Ci)
Di <- (Ti <= Ci) * 1
simData <- data.frame(t.stop = Yi,
is.event = Di,
covariate = Xi,
failure.time = Ti,
censoring.time = Ci)
library(MYHRcpp)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's',
xlab = "time", ylab = "survival")
t.Ti <- sort(unique(test.data1$failure.time))
Shat.empirical <- colMeans(outer(test.data1$failure.time,
sort(unique(test.data1$failure.time)),
FUN = ">"))
lines(sort(unique(test.data1$failure.time)),
Shat.empirical, type = 's', col = 2)
Shat.empirical.biased <- colMeans(
outer(
test.data1$failure.time[test.data1$is.event == 1],
sort(unique(test.data1$failure.time[test.data1$is.event == 1])),
FUN = ">"
)
)
lines(sort(unique(test.data1$failure.time[test.data1$is.event == 1])),
Shat.empirical.biased,
type = 's', lty = 2)
Shat.empirical.biased2 <- colMeans(
outer(
test.data1$failure.time,
sort(unique(test.data1$failure.time)),
FUN = ">"
)
)
lines(sort(unique(test.data1$failure.time)),
Shat.empirical.biased2,
type = 's', lty = 3)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
#####
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's',
xlab = "time", ylab = "survival")
t.Ti <- sort(unique(test.data1$failure.time))
Shat.empirical <- colMeans(outer(test.data1$failure.time,
sort(unique(test.data1$failure.time)),
FUN = ">"))
lines(sort(unique(test.data1$failure.time)),
Shat.empirical, type = 's', lty = 2)
Shat.empirical.biased1 <- colMeans(
outer(
test.data1$t.stop[test.data1$is.event == 1],
sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
FUN = ">"
)
)
lines(sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
Shat.empirical.biased1,
type = 's', lty = 3, col = 2)
Shat.empirical.biased2 <- colMeans(
outer(
test.data1$t.stop,
sort(unique(test.data1$t.stop)),
FUN = ">"
)
)
lines(sort(unique(test.data1$t.stop)),
Shat.empirical.biased2,
type = 's', lty = 3, col = 3)
n <- 100
p <- 5
Xi <- matrix(rnorm(n * p), n, p)
Ci <- 1 + rexp(n)
test.data1 <- simSurv.AFT.normal(Xi = Xi, Ci = Ci,
alpha0 = 1, beta0 = rep(1, 5),
sigma.error = 1)
test.data2 <- simSurv.PH(Xi = Xi, Ci = Ci,
beta0 = rep(1, 5))
#####
Shat <- KME(t.stop = test.data1$t.stop,
is.event = test.data1$is.event)
plot(Shat$jumps, Shat$survival, type = 's',
xlab = "time", ylab = "survival",
ylim = c(0, 1))
Shat.empirical <- colMeans(outer(test.data1$failure.time,
sort(unique(test.data1$failure.time)),
FUN = ">"))
lines(sort(unique(test.data1$failure.time)),
Shat.empirical, type = 's', lty = 2)
Shat.empirical.biased1 <- colMeans(
outer(
test.data1$t.stop[test.data1$is.event == 1],
sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
FUN = ">"
)
)
lines(sort(unique(test.data1$t.stop[test.data1$is.event == 1])),
Shat.empirical.biased1,
type = 's', lty = 3, col = 2)
Shat.empirical.biased2 <- colMeans(
outer(
test.data1$t.stop,
sort(unique(test.data1$t.stop)),
FUN = ">"
)
)
lines(sort(unique(test.data1$t.stop)),
Shat.empirical.biased2,
type = 's', lty = 3, col = 3)
